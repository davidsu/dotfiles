---
description: Neovim migration plan and architecture - auto-attached when working with nvim config
globs:
  - "config.home.symlink/nvim/**/*"
  - "**/nvim/**/*.lua"
alwaysApply: false
---

# Neovim Configuration Guide

When working with Neovim configuration files, always reference the comprehensive migration plan located at:

@config.home.symlink/nvim/MIGRATION_PLAN.md

## ⚠️ CRITICAL: VSCode/Cursor Compatibility Rules

**Never load terminal-only features in VSCode/Cursor.**

### File Splitting Strategy

Use `_terminal.lua` files for terminal-only features:

**Core files** (`core/*.lua`):
- Base file: Universal settings (works in both environments)
- `_terminal.lua`: Terminal-specific additions (underscore, not dot)
- Base file requires `_terminal` only when `not env.is_vscode`

Example:
```lua
-- options.lua (universal base)
opt.number = false  -- VSCode has its own

-- Load terminal-only options
if not env.is_vscode then
  require('core.options_terminal')  -- Note: underscore
end
```

```lua
-- options_terminal.lua
opt.number = true  -- Enable in terminal
```

**Plugin files** (`plugins/*.lua`):
- Terminal-only plugins: Early return at top with `if env.is_vscode then return {} end`
- Universal plugins: No env check, load everywhere

### What to Split

**Terminal-only (use `_terminal.lua` or early return)**:
- Keymaps that don't work in VSCode (FZF, window resizing, custom navigation)
- UI options (statusline, line numbers, showcmd)
- UI plugins (statusline, file tree, colors, scrolling)
- Git plugins (VSCode has built-in)
- Fuzzy finders (VSCode has Cmd+P)
- LSP/completion (VSCode has its own)

**Universal (keep in main files)**:
- Basic vim motions and options
- Text editing plugins (surround, commentary, repeat)
- Clipboard and file settings

## Key Architecture Principles

- **Environment Detection**: Detect Cursor IDE vs Terminal for conditional loading
- **File Split Pattern**: Base file + `_terminal.lua` for core, early return for plugins
- **Pure Lua**: No Vimscript, use Lua exclusively
- **Implementation Order**: Foundation → Essential Plugins → Intelligence → Polish → Advanced

## Current Implementation Status

Check the todos in MIGRATION_PLAN.md for current progress and next steps.

## Progress Tracking Protocol

**CRITICAL**: When implementing items from MIGRATION_PLAN.md:

1. **Update todos frontmatter** in MIGRATION_PLAN.md as you complete tasks:
   - Change `status: pending` → `status: in_progress` when starting
   - Change `status: in_progress` → `status: completed` when done
   
2. **Commit progress updates** separately from implementation:
   - Implementation commit: `feat(nvim): <what was implemented>`
   - Progress commit: `docs(nvim): update MIGRATION_PLAN progress tracking`

3. **Before ending session**: Always update MIGRATION_PLAN.md todos so next agent knows what's done

The todos in the YAML frontmatter are the single source of truth for tracking progress across agent sessions.
